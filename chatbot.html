<!DOCTYPE html>
<html>
  <head>
    <title>ChatBot</title>
    <style>
      body {
        margin-top: 0;
        margin-bottom: 0;
      }
      .send-button {
        background-color: rgb(25, 135, 84);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 10px;
        cursor: pointer;
        margin-left: 10px;
        font-size: 15px;
      }
      .chat-input {
        padding: 8px;
        font-size: 15px;
        border-radius: 10px;
        border: 1px solid gray;
        flex-grow: 1;
      }
      .chat-input-container {
        display: flex;
        margin-bottom: 20px;
      }
      .chatbot-app {
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        font-family: Arial, sans-serif;
        max-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      .chat-message-user {
        padding: 10px;
        border-radius: 10px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        justify-content: end;
      }
      .chat-message-bot {
        padding: 10px;
        border-radius: 10px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
       
      }
      .chat-message-text {    
        background-color: #e1f5fe;
        padding: 10px 15px;
        border-radius: 10px;
        margin-left: 10px;
        margin-right: 10px;
        max-width: 300px;
      }
      .chat-icon {
        width: 40px;
      }
      .chat-messages-container {
        flex-grow: 1;
        
      }
    </style>
  </head>
  <body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/dayjs.js">
        dayjs().format('MMMM D');
    </script>
    <script src="https://unpkg.com/supersimpledev@8.6.4/external-library.js">
    </script>
    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
            function ChatInput({ chatMessages, setChatMessages }) {
             const [inputText, setInputText] =  React.useState("");
              function handleChange(event) {
                setInputText (event.target.value);
              }
              function SendMessage () {
                const newChatMessages = [
                    ...chatMessages,
                    {
                       message: inputText,
                    sender: "user",
                    id: crypto.randomUUID()
                    }
                   ];
                 setChatMessages (newChatMessages);

                   const response = Chatbot.getResponse (inputText);
                   setChatMessages ([
                    ...newChatMessages,
                    {
                       message: response,
                    sender: "bot",
                    id: crypto.randomUUID()
                    }
                   ]);

                   setInputText ("");
                  }
              return (
                <div className="chat-input-container">
                  <input 
                    placeholder="Type your message....." 
                    size="50" 
                    onChange={handleChange }
                    value={inputText}
                    className="chat-input"
                    /> 
                  <button
                  onClick= {SendMessage}
                  className="send-button"
                  >Send</button>  
                </div>
              );
            }
          

            function ChatMessage ({ message, sender })  {
                /* function ChatMessage (props) {
                 const message = props.message;
                 const sender = props.sender;
              */
                // const { message, sender } = props;

               /* if (sender === "bot") {
                  return  (
                    <div>
                      <img src="robot.png" width="30px" />
                  {message}
                </div> 
                  )
                }*/
              return (
                <div className={sender === 'bot' ? "chat-message-bot" : "chat-message-user"}>
                  {sender === "bot" && <img src="robot.png" className="chat-icon" />}
                 <div className="chat-message-text">
                  {message}
                </div>
                  {sender === "user" && <img src="user.png" className="chat-icon" />}
                </div>
                
              )
            }

            function ChatMessages({ chatMessages }) {
                  // useState returns an array with two items
              // const [chatMessages, setChatMessages]
              
                
                return (
                  <div className="chat-messages-container">

                    {chatMessages.map((item) => {
                      return (
                        <ChatMessage 
                          message={item.message}
                          sender={item.sender}
                          key={item.id}
                        />
                      );
                    })}
                  </div>
                );
            }
            function App () {
              const array = React.useState([{
                  message: "Hello ChatBot",
                  sender: "user",
                  id: "id1"
                },
                {
                  message: "How can I help you?",
                  sender: "bot",
                  id: "id2"
                },
                {
                  message: "Can you get me today's date?",
                  sender: "user",
                  id: "id3"
                },
                {
                  message: "Today is November 2",
                  sender: "bot",
                  id: "id4"
                }]);
                const [chatMessages, setChatMessages] = array; //order matters in array destructuring
              /*  const chatMessages = array[0]; // chatMessages
                const setChatMessages = array[1]; // setChatMessages
              */
                

              return (
                <div className="chatbot-app">
                  <ChatMessages
                    chatMessages={chatMessages}
                  />
                   <ChatInput 
                    chatMessages={chatMessages}
                    setChatMessages={setChatMessages}
                  />
                </div>
              );
            }

      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>